<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>סטטיסטיקה – אוצר מילים</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 4px 6px; text-align: center; }
    th { background: #f0f0f0; }
    .strength-rare { background: #ffe4b5; }
    .strength-weak { background: #ffcccc; }
    .strength-medium { background: #fff3cd; }
    .strength-strong { background: #d4edda; }
    #controls { margin-bottom: 10px; }
  </style>
  <script src="../../quiz_core/storage.js"></script>
</head>
<body>
  <h2>סטטיסטיקה – אוצר מילים (גרירה)</h2>
  <div id="controls">
    <button onclick="loadStats()">רענן</button>
    <button onclick="resetStats()">איפוס סטטיסטיקה</button>
  </div>
  <table id="statsTable">
    <thead>
      <tr>
        <th>#</th>
        <th>אנגלית</th>
        <th>עברית</th>
        <th>נכונות</th>
        <th>סך הכל</th>
        <th>% הצלחה</th>
        <th>חוזק</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const QUIZ_ID = "vocab_drag";

    function classify(stat, globalMinTotal) {
      const total = stat ? (stat.total || 0) : 0;
      const correct = stat ? (stat.correct || 0) : 0;
      if (total === globalMinTotal) return 'rare';
      if (total === 0) return 'rare';
      const ratio = total ? correct / total : 0;
      if (ratio < 0.4) return 'weak';
      if (ratio < 0.8) return 'medium';
      return 'strong';
    }

    async function loadStats() {
      const stats = StudyStorage.getQuizStats(QUIZ_ID);
      const resp = await fetch('questions.json');
      const questions = await resp.json();
      const tbody = document.querySelector('#statsTable tbody');
      tbody.innerHTML = '';

      let minTotal = Infinity;
      questions.forEach(q => {
        const s = stats[q.id];
        const t = s ? (s.total || 0) : 0;
        if (t < minTotal) minTotal = t;
      });
      if (!isFinite(minTotal)) minTotal = 0;

      questions.forEach((q, idx) => {
        const s = stats[q.id] || {correct: 0, total: 0};
        const ratio = s.total ? (s.correct / s.total) : 0;
        const strength = classify(s, minTotal);

        const tr = document.createElement('tr');
        tr.classList.add('strength-' + strength);

        const tdIndex = document.createElement('td');
        tdIndex.textContent = idx + 1;
        const tdE = document.createElement('td');
        tdE.textContent = q.english;
        const tdH = document.createElement('td');
        tdH.textContent = q.hebrew;
        const tdC = document.createElement('td');
        tdC.textContent = s.correct;
        const tdT = document.createElement('td');
        tdT.textContent = s.total;
        const tdP = document.createElement('td');
        tdP.textContent = (ratio * 100).toFixed(0) + '%';
        const tdS = document.createElement('td');
        tdS.textContent = strength;

        tr.appendChild(tdIndex);
        tr.appendChild(tdE);
        tr.appendChild(tdH);
        tr.appendChild(tdC);
        tr.appendChild(tdT);
        tr.appendChild(tdP);
        tr.appendChild(tdS);
        tbody.appendChild(tr);
      });
    }

    function resetStats() {
      const code = prompt('הכנס קוד איפוס:');
      if (code === '3333') {
        StudyStorage.resetQuiz(QUIZ_ID);
        loadStats();
      } else if (code !== null) {
        alert('קוד שגוי');
      }
    }

    loadStats();
  </script>
</body>
</html>
